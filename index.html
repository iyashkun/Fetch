<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProNet Analyzer v4.0 - Extreme API Intelligence | Study Project</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { primary: { 50: '#eff6ff', 500: '#3b82f6', 900: '#1e3a8a' }, secondary: { 500: '#10b981' }, accent: { 500: '#f59e0b' } } } }
        }
    </script>
    <!-- Iconify CDN -->
    <script src="https://code.iconify.design/iconify-icon/1.0.8/iconify-icon.min.js"></script>
    <!-- Chart.js for Stats -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .glass { backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }
        .dark .glass { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); }
        .gradient-hero { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); }
        .btn-smooth { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-smooth:hover { transform: translateY(-2px) scale(1.05); box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .skeleton-shimmer { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.2s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .sidebar-slide { transition: transform 0.4s ease-in-out; }
        .sidebar-slide.mobile-open { transform: translateX(0); }
        .mobile-overlay { background: rgba(0,0,0,0.5); transition: opacity 0.3s; }
        .pie-chart-container { position: relative; width: 120px; height: 120px; margin: 0 auto; }
        .pie-chart { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(#3b82f6 0% 60%, #10b981 60% 100%); }
        .pie-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .dark .pie-center { background: #1f2937; color: white; }
        .toast { position: fixed; top: 100px; right: 20px; z-index: 9999; transform: translateX(100%); transition: transform 0.4s ease; max-width: 400px; }
        .toast.show { transform: translateX(0); }
        .qr-code { border: 1px solid #ddd; border-radius: 8px; padding: 8px; }
        @media (max-width: 768px) { .sidebar-slide { transform: translateX(-100%); } .sidebar-slide.mobile-open { transform: translateX(0); } }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen font-sans antialiased">
    <!-- Global Nav (Next.js App Bar Style) -->
    <nav class="gradient-hero shadow-2xl fixed w-full z-50 top-0">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <iconify-icon icon="mdi:api" class="text-3xl text-white"></iconify-icon>
                <h1 class="text-2xl font-bold text-white">ProNet v4.0</h1>
                <span class="text-white/80 text-sm">Extreme Intelligence Tool</span>
            </div>
            <div class="flex items-center space-x-4">
                <select id="langToggle" class="p-2 rounded-full bg-white/20 text-white">
                    <option>EN</option>
                    <option>HI</option>
                </select>
                <button id="themeToggle" class="p-2 rounded-full bg-white/20 hover:bg-white/30 text-white btn-smooth">
                    <iconify-icon icon="mdi:weather-sunny"></iconify-icon>
                </button>
                <button id="mobileMenuToggle" class="md:hidden p-2 rounded-full bg-white/20 hover:bg-white/30 text-white btn-smooth">
                    <iconify-icon icon="mdi:menu"></iconify-icon>
                </button>
            </div>
        </div>
    </nav>

    <!-- Overlay for Mobile -->
    <div id="sidebarOverlay" class="fixed inset-0 z-40 mobile-overlay hidden md:hidden"></div>

    <div class="flex pt-20">
        <!-- Sidebar (Collapsible, Iconify Icons) -->
        <aside id="sidebar" class="sidebar-slide w-80 bg-white dark:bg-gray-800 shadow-2xl h-[calc(100vh-5rem)] overflow-y-auto fixed md:relative z-40 inset-y-20 md:inset-y-0 left-0">
            <div class="p-6">
                <h2 class="text-xl font-semibold mb-6 text-gray-800 dark:text-gray-200 flex items-center">
                    <iconify-icon icon="mdi:view-dashboard" class="mr-2"></iconify-icon>Modes
                </h2>
                <div class="space-y-2 mb-6">
                    <button class="w-full text-left p-4 rounded-xl bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-200 dark:border-blue-800 hover:border-blue-300 btn-smooth mode-btn active" data-mode="posts">
                        <iconify-icon icon="mdi:newspaper" class="text-blue-500 mr-3"></iconify-icon>Posts & Articles
                    </button>
                    <button class="w-full text-left p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-500 btn-smooth mode-btn" data-mode="all-endpoints">
                        <iconify-icon icon="mdi:link-variant" class="text-green-500 mr-3"></iconify-icon>All Endpoints
                    </button>
                    <button class="w-full text-left p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-500 btn-smooth mode-btn" data-mode="fetch">
                        <iconify-icon icon="mdi:download" class="text-indigo-500 mr-3"></iconify-icon>Fetch Calls
                    </button>
                    <button class="w-full text-left p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-500 btn-smooth mode-btn" data-mode="post">
                        <iconify-icon icon="mdi:upload" class="text-red-500 mr-3"></iconify-icon>POST Only
                    </button>
                    <button class="w-full text-left p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-500 btn-smooth mode-btn" data-mode="xhr">
                        <iconify-icon icon="mdi:sync" class="text-yellow-500 mr-3"></iconify-icon>XHR/Send
                    </button>
                    <button class="w-full text-left p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-500 btn-smooth mode-btn" data-mode="scripts">
                        <iconify-icon icon="mdi:code-tags" class="text-purple-500 mr-3"></iconify-icon>Scripts
                    </button>
                    <button class="w-full text-left p-4 rounded-xl bg-red-50 dark:bg-red-900/30 border-2 border-red-200 dark:border-red-800 hover:border-red-300 btn-smooth mode-btn" data-mode="hidden">
                        <iconify-icon icon="mdi:eye-off" class="text-red-500 mr-3"></iconify-icon>Hidden APIs (Pro)
                    </button>
                    <button class="w-full text-left p-4 rounded-xl bg-purple-50 dark:bg-purple-900/30 border-2 border-purple-200 dark:border-purple-800 hover:border-purple-300 btn-smooth mode-btn" data-mode="graphql">
                        <iconify-icon icon="mdi:graphql" class="text-purple-500 mr-3"></iconify-icon>GraphQL
                    </button>
                    <button class="w-full text-left p-4 rounded-xl bg-green-50 dark:bg-green-900/30 border-2 border-green-200 dark:border-green-800 hover:border-green-300 btn-smooth mode-btn" data-mode="ws">
                        <iconify-icon icon="mdi:message-text" class="text-green-500 mr-3"></iconify-icon>WebSockets
                    </button>
                    <button class="w-full text-left p-4 rounded-xl bg-orange-50 dark:bg-orange-900/30 border-2 border-orange-200 dark:border-orange-800 hover:border-orange-300 btn-smooth mode-btn" data-mode="sitemap">
                        <iconify-icon icon="mdi:sitemap" class="text-orange-500 mr-3"></iconify-icon>Sitemap
                    </button>
                    <button class="w-full text-left p-4 rounded-xl bg-gray-50 dark:bg-gray-900/30 border-2 border-gray-200 dark:border-gray-700 hover:border-gray-300 btn-smooth mode-btn" data-mode="robots">
                        <iconify-icon icon="mdi:robot" class="text-gray-500 mr-3"></iconify-icon>Robots.txt
                    </button>
                </div>
                <hr class="my-6 border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200 flex items-center">
                    <iconify-icon icon="mdi:history" class="mr-2"></iconify-icon>Recent Scans
                </h3>
                <div id="historyList" class="space-y-2 max-h-48 overflow-y-auto text-sm"></div>
                <div class="mt-4 p-3 bg-accent-50 dark:bg-accent-900/30 rounded-lg">
                    <p class="text-xs text-accent-700 dark:text-accent-300">Pro Tip: Use proxy for blocked sites.</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 ml-0 md:ml-80 transition-all">
            <!-- Route Container (Hash Routing) -->
            <div id="routeContainer">
                <!-- Default: Scan Route -->
                <div id="scanRoute" class="route active">
                    <section class="glass rounded-3xl p-8 mb-8 shadow-2xl">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center space-y-4 lg:space-y-0">
                            <div>
                                <h2 class="text-4xl font-bold text-gray-800 dark:text-white mb-2 flex items-center">
                                    <iconify-icon icon="mdi:target" class="mr-3 text-primary-500"></iconify-icon>Target Scan
                                </h2>
                                <p class="text-gray-600 dark:text-gray-400">Extreme detection for hidden APIs & dynamic content.</p>
                            </div>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 w-full sm:w-auto">
                                <input type="url" id="urlInput" placeholder="https://x.com" class="flex-1 p-4 border border-gray-300 dark:border-gray-600 rounded-2xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary-500 focus:border-transparent shadow-lg">
                                <button id="analyzeBtn" class="px-8 py-4 bg-gradient-to-r from-primary-500 to-accent-500 text-white rounded-2xl hover:from-primary-600 hover:to-accent-600 btn-smooth shadow-lg font-semibold">
                                    <iconify-icon icon="mdi:rocket-launch" class="mr-2"></iconify-icon>Launch Extreme Scan
                                </button>
                            </div>
                        </div>
                        <div class="mt-8 grid grid-cols-1 md:grid-cols-4 gap-6 text-center">
                            <div class="p-6 rounded-2xl bg-primary-50 dark:bg-primary-900/30 border border-primary-200 dark:border-primary-800">
                                <iconify-icon icon="mdi:chart-line" class="text-3xl text-primary-500 mb-2 block mx-auto"></iconify-icon>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Scans Run: <span id="historyCount">0</span></p>
                            </div>
                            <div class="p-6 rounded-2xl bg-secondary-50 dark:bg-secondary-900/30 border border-secondary-200 dark:border-secondary-800">
                                <iconify-icon icon="mdi:shield-check" class="text-3xl text-secondary-500 mb-2 block mx-auto"></iconify-icon>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Detection Score: <span id="proScore">0%</span></p>
                            </div>
                            <div class="p-6 rounded-2xl bg-accent-50 dark:bg-accent-900/30 border border-accent-200 dark:border-accent-800">
                                <iconify-icon icon="mdi:filter-variant" class="text-3xl text-accent-500 mb-2 block mx-auto"></iconify-icon>
                                <select id="filterSelect" class="text-sm bg-transparent border border-accent-300 rounded-lg p-2">
                                    <option>All</option>
                                    <option>POST</option>
                                    <option>GET</option>
                                    <option>High Score (>0.8)</option>
                                    <option>Hidden</option>
                                </select>
                            </div>
                            <div class="p-6 rounded-2xl bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
                                <iconify-icon icon="mdi:cog" class="text-3xl text-gray-500 mb-2 block mx-auto"></iconify-icon>
                                <select id="proxySelect" class="text-sm bg-transparent">
                                    <option>No Proxy</option>
                                    <option>Rotate Free Proxies</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <!-- Stats Dashboard -->
                    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 hidden" id="statsSection">
                        <div class="glass rounded-2xl p-6 text-center card-hover">
                            <div class="pie-chart-container mb-4">
                                <div class="pie-chart"></div>
                                <div class="pie-center">60%</div>
                            </div>
                            <h3 class="font-bold text-xl">Endpoint Distribution</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">POST/GET Ratio</p>
                        </div>
                        <div class="glass rounded-2xl p-6 text-center card-hover">
                            <iconify-icon icon="mdi:fire" class="text-4xl text-red-500 mb-4 block mx-auto"></iconify-icon>
                            <h3 class="font-bold text-xl" id="highScoreCount">0</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Extreme Hits</p>
                        </div>
                        <div class="glass rounded-2xl p-6 text-center card-hover">
                            <iconify-icon icon="mdi:clock-outline" class="text-4xl text-yellow-500 mb-4 block mx-auto"></iconify-icon>
                            <h3 class="font-bold text-xl" id="scanTime">0s</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Scan Duration</p>
                        </div>
                        <div class="glass rounded-2xl p-6 text-center card-hover">
                            <iconify-icon icon="mdi:share-variant" class="text-4xl text-blue-500 mb-4 block mx-auto"></iconify-icon>
                            <button id="shareBtn" class="text-sm bg-primary-500 text-white px-4 py-2 rounded-lg hover:bg-primary-600 btn-smooth">Share</button>
                        </div>
                    </section>

                    <!-- Results -->
                    <section class="space-y-6">
                        <div id="loadingSkeletons" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 hidden">
                            <div class="card-hover glass rounded-2xl p-6 skeleton-shimmer h-64"></div>
                            <div class="card-hover glass rounded-2xl p-6 skeleton-shimmer h-64"></div>
                            <div class="card-hover glass rounded-2xl p-6 skeleton-shimmer h-64"></div>
                            <div class="card-hover glass rounded-2xl p-6 skeleton-shimmer h-64"></div>
                        </div>
                        <div id="resultsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 hidden"></div>
                        <div id="noResults" class="text-center py-16 hidden col-span-full">
                            <iconify-icon icon="mdi:magnify-scan" class="text-8xl text-gray-400 mb-6 block mx-auto"></iconify-icon>
                            <h3 class="text-3xl font-semibold text-gray-500 dark:text-gray-400 mb-4">No Intelligence Yet</h3>
                            <p class="text-gray-600 dark:text-gray-400">Launch an extreme scan to reveal the hidden!</p>
                            <button class="mt-6 px-8 py-3 bg-primary-500 text-white rounded-xl btn-smooth font-semibold" onclick="analyze()">Start Now</button>
                        </div>
                    </section>

                    <!-- Export Footer -->
                    <footer class="glass rounded-3xl p-6 mt-12 text-center">
                        <div class="flex justify-center space-x-4 flex-wrap gap-2">
                            <button id="exportJson" class="px-6 py-3 bg-gray-500 text-white rounded-2xl hover:bg-gray-600 btn-smooth">
                                <iconify-icon icon="mdi:file-document" class="mr-2"></iconify-icon>JSON
                            </button>
                            <button id="exportCsv" class="px-6 py-3 bg-green-500 text-white rounded-2xl hover:bg-green-600 btn-smooth">
                                <iconify-icon icon="mdi:file-delimited" class="mr-2"></iconify-icon>CSV
                            </button>
                            <button id="exportPdf" class="px-6 py-3 bg-purple-500 text-white rounded-2xl hover:bg-purple-600 btn-smooth">
                                <iconify-icon icon="mdi:file-pdf" class="mr-2"></iconify-icon>PDF
                            </button>
                            <button id="clearHistory" class="px-6 py-3 bg-red-500 text-white rounded-2xl hover:bg-red-600 btn-smooth">
                                <iconify-icon icon="mdi:delete" class="mr-2"></iconify-icon>Clear
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-4 flex items-center justify-center">
                            <iconify-icon icon="mdi:shield-check-outline" class="mr-2"></iconify-icon>Ethical Tool - Respect robots.txt | © 2025 ProNet
                        </p>
                    </footer>
                </div>

                <!-- History Route -->
                <div id="historyRoute" class="route hidden">
                    <section class="glass rounded-3xl p-8 mb-8 shadow-2xl">
                        <h2 class="text-4xl font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                            <iconify-icon icon="mdi:history" class="mr-3 text-accent-500"></iconify-icon>Scan History
                        </h2>
                        <div id="historyGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    </section>
                </div>

                <!-- Settings Route -->
                <div id="settingsRoute" class="route hidden">
                    <section class="glass rounded-3xl p-8 mb-8 shadow-2xl">
                        <h2 class="text-4xl font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                            <iconify-icon icon="mdi:cog" class="mr-3 text-secondary-500"></iconify-icon>Settings
                        </h2>
                        <div class="space-y-6">
                            <div class="p-6 border border-gray-200 dark:border-gray-700 rounded-2xl">
                                <h3 class="font-semibold mb-4">Proxy Config</h3>
                                <textarea id="proxyList" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700" placeholder="proxy1:port&#10;proxy2:port (one per line)"></textarea>
                                <button id="saveProxies" class="mt-4 px-6 py-3 bg-secondary-500 text-white rounded-xl btn-smooth">Save Proxies</button>
                            </div>
                            <div class="p-6 border border-gray-200 dark:border-gray-700 rounded-2xl">
                                <h3 class="font-semibold mb-4">Language</h3>
                                <select id="langSelect" class="p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700">
                                    <option>English</option>
                                    <option>Hindi</option>
                                </select>
                            </div>
                            <div class="p-6 border border-gray-200 dark:border-gray-700 rounded-2xl">
                                <h3 class="font-semibold mb-4">PWA Install</h3>
                                <button id="installPWA" class="px-6 py-3 bg-primary-500 text-white rounded-xl btn-smooth">Install App</button>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Add to home screen for offline scans.</p>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast p-4 rounded-2xl shadow-2xl text-white font-medium"></div>

    <script>
        // Advanced State (Next.js-like Router)
        class Router {
            constructor() {
                this.routes = {
                    '': 'scanRoute',
                    '#scan': 'scanRoute',
                    '#history': 'historyRoute',
                    '#settings': 'settingsRoute'
                };
                window.addEventListener('hashchange', () => this.render());
                this.render();
            }
            render() {
                const hash = window.location.hash || '#scan';
                Object.values(document.querySelectorAll('.route')).forEach(r => r.classList.add('hidden'));
                document.getElementById(this.routes[hash] || 'scanRoute').classList.remove('hidden');
                // Sidebar links
                document.querySelectorAll('[data-route]').forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === hash);
                });
            }
        }
        new Router();

        // State & DOM
        let currentMode = 'posts';
        let scanHistory = JSON.parse(localStorage.getItem('scanHistory') || '[]');
        let proxies = JSON.parse(localStorage.getItem('proxies') || '[]');
        const maxHistory = 20;

        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const mobileToggle = document.getElementById('mobileMenuToggle');
        const themeToggle = document.getElementById('themeToggle');
        const langToggle = document.getElementById('langToggle');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const urlInput = document.getElementById('urlInput');
        const resultsGrid = document.getElementById('resultsGrid');
        const loadingSkeletons = document.getElementById('loadingSkeletons');
        const noResults = document.getElementById('noResults');
        const statsSection = document.getElementById('statsSection');
        const historyList = document.getElementById('historyList');
        const filterSelect = document.getElementById('filterSelect');
        const proxySelect = document.getElementById('proxySelect');
        const toast = document.getElementById('toast');
        const exportJson = document.getElementById('exportJson');
        const exportCsv = document.getElementById('exportCsv');
        const exportPdf = document.getElementById('exportPdf');
        const clearHistory = document.getElementById('clearHistory');
        const shareBtn = document.getElementById('shareBtn');
        const historyCount = document.getElementById('historyCount');
        const historyGrid = document.getElementById('historyGrid');
        const saveProxies = document.getElementById('saveProxies');
        const langSelect = document.getElementById('langSelect');
        const installPWA = document.getElementById('installPWA');

        // Theme (System Support)
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            const icon = themeToggle.querySelector('iconify-icon');
            icon.setAttribute('icon', isDark ? 'mdi:weather-sunny' : 'mdi:weather-night');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
        if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            themeToggle.querySelector('iconify-icon').setAttribute('icon', 'mdi:weather-sunny');
        }

        // Mobile Sidebar
        mobileToggle.addEventListener('click', () => {
            sidebar.classList.toggle('mobile-open');
            sidebarOverlay.classList.toggle('hidden');
        });
        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.remove('mobile-open');
            sidebarOverlay.classList.add('hidden');
        });

        // Mode & Lang
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active', 'bg-blue-100', 'dark:bg-blue-900'));
                btn.classList.add('active', 'bg-blue-100', 'dark:bg-blue-900');
                currentMode = btn.dataset.mode;
            });
        });
        langSelect.addEventListener('change', () => {
            // Mock multi-lang – replace textContent with translations
            showToast(`Language set to ${langSelect.value}`);
        });

        // History Render (with Grid for /history)
        function renderHistory(grid = false) {
            const list = grid ? historyGrid : historyList;
            list.innerHTML = scanHistory.slice(-maxHistory).reverse().map(h => `
                <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-2xl btn-smooth cursor-pointer hover:shadow-lg" onclick="loadHistory('${h.url}', '${h.mode}')">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <iconify-icon icon="mdi:target" class="mr-3 text-primary-500"></iconify-icon>
                            <span class="font-medium">${h.mode.toUpperCase()}</span>
                        </div>
                        <div class="text-right">
                            <p class="text-sm">${h.url}</p>
                            <p class="text-xs text-gray-500">${new Date(h.timestamp).toLocaleDateString()}</p>
                            <p class="text-xs text-gray-500">${h.count} items</p>
                        </div>
                    </div>
                </div>
            `).join('');
            historyCount.textContent = scanHistory.length;
        }
        renderHistory();

        function loadHistory(url, mode) {
            urlInput.value = url;
            document.querySelector(`[data-mode="${mode}"]`).click();
            analyze();
        }

        // Proxy Save
        saveProxies.addEventListener('click', () => {
            proxies = document.getElementById('proxyList').value.split('\n').map(p => p.trim()).filter(p => p);
            localStorage.setItem('proxies', JSON.stringify(proxies));
            showToast('Proxies saved! Use in scans.');
        });
        document.getElementById('proxyList').value = proxies.join('\n');

        // PWA Install
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });
        installPWA.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                showToast(outcome === 'accepted' ? 'PWA Installed!' : 'Install canceled.');
                deferredPrompt = null;
            }
        });

        // Scan with Proxy
        async function analyze() {
            const url = urlInput.value.trim();
            if (!url.startsWith('http')) {
                showToast('Invalid URL!', 'error');
                return;
            }
            const useProxy = proxySelect.value === 'Rotate Free Proxies' ? proxies[0] || '' : '';  // Simple rotation

            loadingSkeletons.classList.remove('hidden');
            resultsGrid.classList.add('hidden');
            statsSection.classList.add('hidden');
            noResults.classList.add('hidden');

            const startTime = Date.now();
            try {
                const response = await fetch('/api/fetch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, mode: currentMode, proxy: useProxy })
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || `HTTP ${response.status}`);
                }

                const data = await response.json();
                const endTime = Date.now();
                loadingSkeletons.classList.add('hidden');

                if (data.error) {
                    throw new Error(data.error);
                }

                const items = data.items || [];
                const count = data.found || data.count || items.length;
                showToast(`${count} extreme hits in ${((endTime - startTime)/1000).toFixed(1)}s! ${useProxy ? '(Via Proxy)' : ''}`, 'success');

                // Stats Update
                document.getElementById('highScoreCount').textContent = items.filter(i => (i.score || 0) > 0.8).length;
                document.getElementById('scanTime').textContent = `${((endTime - startTime)/1000).toFixed(1)}s`;
                document.getElementById('proScore').textContent = `${Math.round((items.reduce((sum, i) => sum + (i.score || 0), 0) / count * 100) || 0)}%`;

                // Render with Filter
                let filteredItems = items;
                filterSelect.onchange = () => {
                    const val = filterSelect.value;
                    filteredItems = items.filter(i => {
                        if (val === 'POST') return i.method === 'POST';
                        if (val === 'GET') return i.method === 'GET';
                        if (val === 'High Score (>0.8)') return (i.score || 0) > 0.8;
                        if (val === 'Hidden') return i.method.includes('HIDDEN');
                        return true;
                    });
                    renderResults(filteredItems);
                };

                renderResults(filteredItems);

                // History Save
                scanHistory.unshift({ url, mode: currentMode, timestamp: Date.now(), count, proxy: useProxy });
                if (scanHistory.length > maxHistory) scanHistory = scanHistory.slice(0, maxHistory);
                localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
                localStorage.setItem('lastResults', JSON.stringify(items));
                renderHistory();

                statsSection.classList.remove('hidden');
                resultsGrid.classList.remove('hidden');
            } catch (error) {
                loadingSkeletons.classList.add('hidden');
                showToast(`Extreme scan failed: ${error.message}`, 'error');
                noResults.classList.remove('hidden');
                console.error(error);
            }
        }

        function renderResults(items) {
            if (items.length === 0) {
                resultsGrid.innerHTML = '<p class="col-span-full text-center text-gray-500 py-12">No extreme matches. Adjust filters!</p>';
                return;
            }
            resultsGrid.innerHTML = items.map(item => `
                <div class="card-hover glass rounded-2xl p-6 border border-gray-200 dark:border-gray-700 relative overflow-hidden">
                    <div class="absolute top-2 right-2 text-xs badge bg-${item.method === 'POST' ? 'red' : 'green'}-100 text-${item.method === 'POST' ? 'red' : 'green'}-800 px-2 py-1 rounded-full">${item.method || 'N/A'}</div>
                    <h3 class="font-bold text-lg mb-3 flex items-center">${item.title || item.url}
                        <span class="ml-auto text-xs text-green-600 dark:text-green-400">${(item.score * 100).toFixed(0)}%</span>
                    </h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">${item.context || item.source || 'N/A'}</p>
                    <div class="flex space-x-2">
                        <input class="flex-1 p-2 text-xs bg-gray-100 dark:bg-gray-800 rounded-lg border" value="${item.url || item.href}" readonly>
                        <button onclick="copyToClipboard('${item.url || item.href}')" class="p-2 text-blue-500 hover:text-blue-700 rounded-lg btn-smooth">
                            <iconify-icon icon="mdi:content-copy"></iconify-icon>
                        </button>
                        <a href="${item.url || item.href}" target="_blank" class="p-2 text-green-500 hover:text-green-700 rounded-lg btn-smooth">
                            <iconify-icon icon="mdi:open-in-new"></iconify-icon>
                        </a>
                    </div>
                </div>
            `).join('');
        }

        function showToast(msg, type = 'success') {
            toast.innerHTML = `<iconify-icon icon="mdi:${type === 'error' ? 'alert-circle' : 'check-circle'}" class="mr-2"></iconify-icon>${msg}`;
            toast.className = `toast p-4 rounded-2xl shadow-2xl text-white font-medium bg-${type === 'error' ? 'red' : 'green'}-500`;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => showToast('Copied!'));
        }

        function exportData(type) {
            const items = JSON.parse(localStorage.getItem('lastResults') || '[]');
            if (items.length === 0) return showToast('No data!', 'error');
            if (type === 'json') {
                const blob = new Blob([JSON.stringify(items, null, 2)], { type: 'application/json' });
                downloadBlob(blob, `pronet-v4-${currentMode}-${Date.now()}.json`);
            } else if (type === 'csv') {
                let csv = 'Method,URL,Context,Score\n';
                items.forEach(item => csv += `"${item.method || ''}","${item.url || ''}","${item.context || ''}","${(item.score || 0).toFixed(2)}"\n`);
                const blob = new Blob([csv], { type: 'text/csv' });
                downloadBlob(blob, `pronet-v4-${currentMode}-${Date.now()}.csv`);
            } else if (type === 'pdf') {
                // Mock PDF – in real, call /api/export-pdf
                showToast('PDF gen via Puppeteer (backend call)');
                fetch('/api/fetch', { method: 'POST', body: JSON.stringify({ url: 'pdf', mode: 'export' }) }).then(r => r.blob()).then(blob => downloadBlob(blob, 'results.pdf'));
            }
            showToast(`Exported ${type.toUpperCase()}!`);
        }

        function downloadBlob(blob, filename) {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            a.click();
            URL.revokeObjectURL(a.href);
        }

        function shareResults() {
            const shareUrl = `${window.location.origin}${window.location.hash}?url=${encodeURIComponent(urlInput.value)}&mode=${currentMode}`;
            // QR Code gen mock
            const qr = document.createElement('canvas');
            // Use QR lib if needed, mock here
            navigator.clipboard.writeText(shareUrl).then(() => showToast('Share link copied + QR ready!'));
        }

        // Voice Mode Sim (Web Speech)
        const recognition = 'webkitSpeechRecognition' in window ? new webkitSpeechRecognition() : null;
        if (recognition) {
            recognition.onresult = e => urlInput.value = e.results[0][0].transcript;
            // Add mic button if wanted
        }

        // Event Listeners
        analyzeBtn.addEventListener('click', analyze);
        urlInput.addEventListener('keypress', e => { if (e.key === 'Enter') analyze(); });
        exportJson.addEventListener('click', () => exportData('json'));
        exportCsv.addEventListener('click', () => exportData('csv'));
        exportPdf.addEventListener('click', () => exportData('pdf'));
        clearHistory.addEventListener('click', () => {
            scanHistory = [];
            localStorage.removeItem('scanHistory');
            renderHistory();
            showToast('History cleared!');
        });
        shareBtn.addEventListener('click', shareResults);
        proxySelect.addEventListener('change', () => showToast('Proxy mode updated!'));

        // Init
        const params = new URLSearchParams(window.location.search);
        if (params.get('url')) {
            urlInput.value = params.get('url');
            if (params.get('mode')) document.querySelector(`[data-mode="${params.get('mode')}"]`).click();
            setTimeout(analyze, 500);
        }
        renderHistory(true);  // For history route
    </script>
</body>
</html>
